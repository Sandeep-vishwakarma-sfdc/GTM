[Select id,Name from Account]

List<GTM_Details__c> gtmDetails = GTMPathFinder.getCatergoryAllocation();
System.debug(gtmDetails);

System.debug(Userinfo.getUserId());

select Id,Name from Account where Sales_Org_Code__c='5631'  and recordType.Id='0120k000000P0eQAAS' and Lead_Customer_Ownership__c='005280000017DV0'

select id,Name, from Product_Category_Sales_Org_Mapping__c where Status__c='Active' and Sales_Org__r.Sales_Org_Code__c='5631'

delete [Select Id,Name from GTM_Details__c];

GTMPathFinder.getCatergoryAllocation();

SELECT FiscalYearSettings.Name , StartDate,EndDate, type FROM Period WHERE Type = 'Year' AND StartDate <= TODAY AND EndDate >= TODAY limit 1

leadcustomerRecordType 0120k000000P0eQAAS

select Id,Name,Lead_Customer_Type__c from Account where Sales_Org_Code__c='5631'  and recordType.Id='0120k000000P0eQAAS' and Lead_Customer_Ownership__c='005280000017DV0'

String leadRecordType = '0120k000000P0eQAAS';

select Id,Name from Account where Sales_Org_Code__c='5631' and Account_Type__c='Sold To Party' and Lead_Customer__c!=null and Lead_Customer_Ownership__c='005280000017DV0' and recordTypeId='0120k000000P0eQAAS'

GTMPathFinder.getGTMCustomers();

GTMPathFinder.updateGTMDetail('a4k0k0000002RFtAAM','50');

List<Account> ac = GTMPathFinder.getGTMCustomers();
System.debug(ac.size());

List<GTM_Details__c> details = [SELECT ID,Name,GTM__c from GTM_Details__c where GTM__c='a8Z1m00000002t5'];
delete details;
System.debug(details[0].get('Name'));
delete details;

------------------------------------------------------------------------------------------------

select Id,Name from Crop__c where GTM_Status__c='Active' and Sales_Org_Code__c='5631'
Map<string,List<GTM_Details__c>> cropmap = GTMPathFinder.getCropAllocation();
System.debug(cropmap);

List<Crop__c> crops = GTMPathFinder.getActiveCrop();
System.debug('Crops '+crops.size());

GTM__c gtm = [select Id,Name from GTM__c];
GTMPathFinder.createGTMPotentialAndProfile(gtm);

delete [select Id,Name from GTM__c where id='a8Z1m00000002t5'];

Decimal val = Decimal.valueOf(null);


--------------------------------------- OUTLOOK ----------------------------------------------------

Id recordTypePotentialProfile = Schema.SObjectType.GTM_Details__c.getRecordTypeInfosByName().get('Outlook').getRecordTypeId();

List<GTM_Details__c> gtmDetailsList = [Select Id, GTM_Customer__r.Name, GTM_Customer__c, Estimated_Growth_NY_to_2NY__c, Estimated_Growth_PY_to_CY__c, Estimated_Growth_PY_to_NY__c, Sales_Org__c from GTM_Details__c];

delete gtmDetailsList;

List<GTM_Details__c> outlooks = GTMOutlook.getGTMOutlook();
System.debug('size'+outlooks.size());

------------------------------------- Product Category --------------------------------------------------

GTMPathFinder.getCatergoryAllocation();

---------------------------------------GTM Configuration -------------------------------

---------------------------------------GTM CUSTOMERS ----------------------------------
        Id userId = userInfo.getUserId();
        GTM__c gtm = [SELECT ID,Name,Fiscal_Year__c from GTM__c where Fiscal_Year__c='2020-2021' and Sales_Org__c='a1F5D000001aUJo' and Sales_Rep__c=:userId limit 1];
        
        Sales_Org__c  salesorg = [select Id,Name from Sales_Org__c where Id='a1F5D000001aUJo']; 

        Map<String,GTM_Details__c> mapPotentialProfile = new  Map<String,GTM_Details__c>();
        List<Account> newCustomers = GTMPathFinder.getNewGTMCustomers();
        System.debug('lst account  '+newCustomers);
        Id recordTypePotentialProfile = Schema.SObjectType.GTM_Details__c.getRecordTypeInfosByName().get('Profile & Potential').getRecordTypeId();
        Id recordTypeCropAllocation = Schema.SObjectType.GTM_Details__c.getRecordTypeInfosByName().get('Crop Allocation').getRecordTypeId();
        Id recordTypeProductCategory = Schema.SObjectType.GTM_Details__c.getRecordTypeInfosByName().get('Product Category Allocation').getRecordTypeId();
        Id recordTypeCompetition = Schema.SObjectType.GTM_Details__c.getRecordTypeInfosByName().get('Competitor').getRecordTypeId();
        Id recordTypeOutlook = Schema.SObjectType.GTM_Details__c.getRecordTypeInfosByName().get('Outlook').getRecordTypeId();

        List<GTM_Details__c> gtmDetails = new List<GTM_Details__c>();
        //Create Potential Profile for newly added customers
        for(Account acc:newCustomers){
            GTM_Details__c gtmd = new GTM_Details__c();
            gtmd.GTM_Customer__c = acc.Id;
            gtmd.recordTypeId = recordTypePotentialProfile;
            gtmd.GTM_Customer_Type__c = acc.Lead_Customer_Type__c;
            gtmd.GTM__c = gtm.Id;
            gtmd.Sales_Org__c = salesorg.Id;
            gtmDetails.add(gtmd);
        }
        insert gtmDetails;
        
        for(GTM_Details__c gtm1:gtmDetails){
            mapPotentialProfile.put(gtm1.GTM_Customer__c,gtm1);
        }
        // Create Crop Allocation for newly added Customers
        gtmDetails.clear();
        for(Account acc:newCustomers){
            for(Crop__c crop:GTMPathFinder.getActiveCrop()){
                System.debug('For loop Crop__c '+crop);
                GTM_Details__c gtmDetail = new GTM_Details__c();
                gtmDetail.recordTypeId = recordTypeCropAllocation;
                gtmDetail.Crop__c = crop.Id;
                gtmDetail.GTM_Customer__c = acc.Id;
                gtmDetail.Sales_Org__c = salesOrg.Id;
                gtmDetail.GTM__c = gtm.Id;
                gtmDetail.GTM_Details__c = mapPotentialProfile.get(acc.Id).Id;
                gtmDetails.add(gtmDetail);
            }
        }
        insert gtmDetails;

        // Create Product Allocation for newly added Customers
        gtmDetails.clear();
        for(Account acc:newCustomers){
            for(Product_Category__c pc:GTMPathFinder.getActiveProductCategory()){
                System.debug('For loop Product_Category__c '+pc);
                GTM_Details__c gtmDetail = new GTM_Details__c();
                gtmDetail.recordTypeId = recordTypeProductCategory;
                gtmDetail.Product_Category__c = pc.Id;
                gtmDetail.GTM_Customer__c = acc.Id;
                gtmDetail.Sales_Org__c = salesOrg.Id;
                gtmDetail.GTM__c = gtm.Id;
                gtmDetail.GTM_Details__c = mapPotentialProfile.get(acc.Id).Id;
                gtmDetails.add(gtmDetail);
            }
        }
        insert gtmDetails;

        // Create Competition for newly added Customers
        gtmDetails.clear();
        for(Account acc:newCustomers){
            GTM_Details__c gtmd = new GTM_Details__c();
            gtmd.recordTypeId = recordTypeCompetition;
            gtmd.GTM_Customer__c = acc.Id;
            gtmd.GTM__c=gtm.Id;
            gtmd.Sales_Org__c=salesOrg.Id;
            gtmd.GTM_Details__c = mapPotentialProfile.get(acc.Id).Id;
            gtmDetails.add(gtmd);
        }
        insert gtmDetails;

        //Create outlook 
        gtmDetails.clear();
        for(Account acc :newCustomers){
            GTM_Details__c gtmDetailsTemp = new GTM_Details__c();
            gtmDetailsTemp.recordTypeId = recordTypeOutlook;
            gtmDetailsTemp.GTM_Customer__c = acc.Id;
            gtmDetailsTemp.Sales_Org__c = salesorg.Id;
            gtmDetailsTemp.GTM__c = gtm.Id;
            gtmDetailsTemp.GTM_Details__c = mapPotentialProfile.get(acc.Id).Id;
            gtmDetails.add(gtmDetailsTemp);
         }
         insert gtmDetails;
